<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Funny Ape Faces VR</title>
<style>
  body { margin: 0; overflow: hidden; }
  #info { position: absolute; top: 10px; left: 10px; color: white; font-weight: bold; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px; z-index: 10;}
</style>
</head>
<body>
<div id="info">Move: WASD | Jump: Space | VR: Enter VR</div>
<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script>
const canvas = document.createElement("canvas");
document.body.appendChild(canvas);
const engine = new BABYLON.Engine(canvas, true);

const createScene = function() {
    const scene = new BABYLON.Scene(engine);
    scene.clearColor = new BABYLON.Color3(0.53,0.81,0.92); // Sky blue

    // Camera
    const camera = new BABYLON.UniversalCamera("camera", new BABYLON.Vector3(0, 2, -5), scene);
    camera.attachControl(canvas, true);

    // Lighting
    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0,1,0), scene);

    // Ground
    const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:50, height:50}, scene);
    const groundMat = new BABYLON.StandardMaterial("groundMat", scene);
    groundMat.diffuseColor = new BABYLON.Color3(0.13,0.55,0.13);
    ground.material = groundMat;

    // Gorilla made of faces
    const faceTextures = [
        "https://i.imgur.com/U1X9F1F.png",
        "https://i.imgur.com/7D6sP7b.png",
        "https://i.imgur.com/5s5C5Cw.png"
    ];

    const gorilla = new BABYLON.TransformNode("gorilla", scene);

    function createFaceCube(x,y,z){
        const mat = new BABYLON.StandardMaterial("mat", scene);
        const tex = faceTextures[Math.floor(Math.random()*faceTextures.length)];
        mat.diffuseTexture = new BABYLON.Texture(tex, scene);
        const cube = BABYLON.MeshBuilder.CreateBox("cube", {size:0.5}, scene);
        cube.material = mat;
        cube.position.set(x,y,z);
        cube.parent = gorilla;
    }

    const gorillaStructure = [
        [0,1,0],[0,1.5,0],[0,2,0],[0,2.5,0], // head
        [-0.5,1,0],[0.5,1,0], // arms
        [-0.5,0.5,0],[0.5,0.5,0],[0,0.5,0] // body
    ];

    gorillaStructure.forEach(pos => createFaceCube(...pos));

    // Movement
    const keys = {};
    window.addEventListener('keydown', e=> keys[e.code]=true);
    window.addEventListener('keyup', e=> keys[e.code]=false);

    let velocityY = 0;
    const gravity = -9.8;
    const jumpStrength = 5;

    scene.onBeforeRenderObservable.add(()=>{
        const dt = engine.getDeltaTime()/1000;
        const speed = 5;

        // WASD movement
        if(keys['KeyW']) gorilla.position.z += speed*dt;
        if(keys['KeyS']) gorilla.position.z -= speed*dt;
        if(keys['KeyA']) gorilla.position.x -= speed*dt;
        if(keys['KeyD']) gorilla.position.x += speed*dt;

        // Jump
        if(keys['Space'] && gorilla.position.y <= 0.5){
            velocityY = jumpStrength;
        }

        // Gravity
        velocityY += gravity*dt;
        gorilla.position.y += velocityY*dt;
        if(gorilla.position.y < 0.5){
            gorilla.position.y = 0.5;
            velocityY = 0;
        }

        // Smooth camera follow
        const targetPos = new BABYLON.Vector3(gorilla.position.x, gorilla.position.y + 2, gorilla.position.z - 5);
        camera.position = BABYLON.Vector3.Lerp(camera.position, targetPos, 0.1);
        camera.setTarget(gorilla.position);
    });

    // WebXR
    scene.createDefaultXRExperienceAsync({
        floorMeshes: [ground]
    }).then((xr)=>{
        console.log("WebXR ready!");
    }).catch(err=>{
        console.warn("WebXR error:", err);
    });

    return scene;
};

const scene = createScene();
engine.runRenderLoop(()=> scene.render());

window.addEventListener('resize', ()=> engine.resize());
</script>
</body>
</html>
